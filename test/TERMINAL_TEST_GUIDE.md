# 🖥️ 터미널 치지직 채팅 테스트 가이드

## 📋 개요
터미널에서 치지직 채팅을 실시간으로 테스트할 수 있는 도구입니다.

## 🚀 빠른 시작

### 1. 의존성 설치
```bash
npm install
```

### 2. 테스트 실행
```bash
# 1단계: API 연결 테스트 (필수!)
npm run api-test [채널ID]

# 2단계: 채널 정보 상세 확인
npm run channel-info [채널ID]

# 3단계: 채팅 테스트 (API 테스트 성공 후)
npm run chat-test [채널ID]

# 직접 실행도 가능
node test/chzzk-api-test.js [채널ID]
node test/chzzk-channel-info.js [채널ID]
node test/chzzk-chat-terminal.js [채널ID]
```

### 3. 실제 사용 예시
```bash
# 예시 채널로 전체 테스트
npm run api-test 789d1d9c5b58c847f9f18c8e5073c580
npm run channel-info 789d1d9c5b58c847f9f18c8e5073c580
npm run chat-test 789d1d9c5b58c847f9f18c8e5073c580

# 기본 채널들 모두 테스트
node test/chzzk-channel-info.js --all
```

## 🔍 채널 ID 찾는 방법

1. **치지직 방송 페이지 접속**
   - 원하는 방송 채널로 이동

2. **URL에서 채널 ID 복사**
   - URL 예시: `https://chzzk.naver.com/live/9ae7d38b629b78f48e49fb3106218ff5`
   - 여기서 `9ae7d38b629b78f48e49fb3106218ff5`가 채널 ID

3. **채널 ID 특징**
   - 32자리 영문+숫자 조합
   - 라이브 방송 중인 채널만 채팅 연결 가능

## 🎯 주요 기능

### 🔄 자동 서버 전환
- **kr-ss1.chat.naver.com** → **kr-ss2.chat.naver.com** → **kr-ss3.chat.naver.com**
- 한 서버가 실패하면 자동으로 다음 서버 시도
- 연결 중단 시 자동 재연결

### 📡 실시간 채팅 수신
- 닉네임, 시간, 메시지 내용 실시간 표시
- 메시지 카운터로 수신량 확인
- 한국어 시간 형식으로 표시

### 💓 연결 안정성
- 20초마다 자동 핑퐁 체크
- 서버 응답 시간 모니터링
- 연결 상태 실시간 확인

### 🔍 채널 정보 상세 조회
- 📋 **전체 API 응답**: 치지직 채널의 모든 데이터를 상세히 확인
- 🎯 **구조화된 출력**: 카테고리별로 정리된 정보 표시
- 📊 **실시간 통계**: 팔로워 수, 시청자 수, 구독자 정보 등
- 🔴 **라이브 상태**: 현재 방송 제목, 썸네일, 시청자 수 등
- 💰 **구독 정보**: 구독료, 구독 전용 컨텐츠 여부 등
- 🎮 **활동 정보**: 현재 플레이 중인 게임, 카테고리 등
- 📄 **원본 JSON**: 전체 API 응답을 JSON 형태로 확인 가능

## 📊 터미널 출력 예시

### API 테스트 결과 (성공 케이스)
```
🎮 치지직 API 테스트 시작
============================================================

📡 라이브 상태 API 테스트
🔗 https://api.chzzk.naver.com/polling/v1/channels/789d1d9c5b58c847f9f18c8e5073c580/live-status
------------------------------------------------------------
🔍 1. 기본 User-Agent 시도 중...
   ❌ 실패: HTTP 500: 앱 업데이트 후에 정상 시청 가능합니다.
🔍 2. 완전한 브라우저 헤더 시도 중...
   ❌ 실패: HTTP 500: 앱 업데이트 후에 정상 시청 가능합니다.
🔍 3. 모바일 User-Agent 시도 중...
   ❌ 실패: HTTP 500: 앱 업데이트 후에 정상 시청 가능합니다.
🔍 4. curl 시뮬레이션 시도 중...
   ❌ 실패: HTTP 500: 앱 업데이트 후에 정상 시청 가능합니다.
   🚫 모든 방법 실패

📡 채널 정보 API 테스트
🔗 https://api.chzzk.naver.com/service/v1/channels/789d1d9c5b58c847f9f18c8e5073c580
------------------------------------------------------------
🔍 1. 기본 User-Agent 시도 중...
   ✅ 성공! (HTTP 200)
   📺 채널명: 아우슈
   📊 상태: OPEN

📋 테스트 결과 요약
============================================================

✅ 성공한 API 엔드포인트:
1. 채널 정보 API
   🔧 성공 방법: 기본 User-Agent
   🔗 URL: https://api.chzzk.naver.com/service/v1/channels/789d1d9c5b58c847f9f18c8e5073c580

❌ 실패한 API 엔드포인트:
1. 라이브 상태 API
   🚫 오류: HTTP 500: 앱 업데이트 후에 정상 시청 가능합니다.
   🔗 URL: https://api.chzzk.naver.com/polling/v1/channels/789d1d9c5b58c847f9f18c8e5073c580/live-status

📊 전체 결과: 1/2 성공

🎉 일부 API가 성공했습니다! 채팅 테스트를 진행할 수 있습니다.
💡 명령어: npm run chat-test 789d1d9c5b58c847f9f18c8e5073c580

🏁 테스트 완료
```

### 채팅 테스트 결과
```
🎮 치지직 채팅 웹소켓 터미널 테스터
=====================================

✅ 채널 ID 유효성 검사 통과: 789d1d9c5b58c847f9f18c8e5073c580

🚀 치지직 채팅 연결 시작: 789d1d9c5b58c847f9f18c8e5073c580
==================================================
📡 채널 정보 가져오는 중: 789d1d9c5b58c847f9f18c8e5073c580
✅ 채널 정보 수신 완료
🔍 채널 상태: OPEN
💬 채팅 채널 ID 가져오는 중...
✅ 채팅 채널 ID: N138tD
🔑 액세스 토큰 가져오는 중...
✅ 액세스 토큰 획득 완료
🌐 웹소켓 서버 1/3 연결 시도: wss://kr-ss1.chat.naver.com/chat
📡 웹소켓 연결 성공: wss://kr-ss1.chat.naver.com/chat
✅ 웹소켓 서버 1 연결 성공!
📤 연결 요청 전송...
🎉 채팅 채널 연결 완료!

📢 실시간 채팅 메시지:
--------------------------------------------------
[001] 오후 2:45:23 | 스트리머팬: 안녕하세요!
[002] 오후 2:45:25 | 구독자123: ㅋㅋㅋㅋㅋ
[003] 오후 2:45:27 | 뷰어456: 오늘 방송 재밌네요
💓 PING 수신 - PONG 응답
[004] 오후 2:45:30 | 팔로워789: 화이팅!!

⌨️  종료하려면 Ctrl+C 또는 "quit"을 입력하세요.
```

### 채널 정보 상세 조회 결과
```
📡 채널 정보 조회 중...
🆔 채널 ID: 789d1d9c5b58c847f9f18c8e5073c580
================================================================================
🔗 API URL: https://api.chzzk.naver.com/service/v1/channels/789d1d9c5b58c847f9f18c8e5073c580

✅ API 호출 성공!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 응답 코드: 200
📋 응답 메시지: null

📺 채널 기본 정보:
--------------------------------------------------
🆔 채널 ID: 789d1d9c5b58c847f9f18c8e5073c580
📛 채널명: 아우슈
🖼️  채널 이미지: https://nng-phinf.pstatic.net/...
✅ 인증 마크: 없음
📺 채널 타입: STREAMING
📝 채널 설명: 없음

📊 채널 통계:
--------------------------------------------------
👥 팔로워 수: 2명
📺 라이브 오픈: 허용
💬 팔로워 채팅: 불가능
🎥 VOD 게시: 불가능

👤 개인 데이터:
--------------------------------------------------
🔔 팔로우 상태: 미팔로잉
🔕 알림 설정: 꺼짐
💰 구독 상태: 미구독

🔴 라이브 정보:
--------------------------------------------------
📺 상태: OPEN
🏷️  제목: 테스트 방송
🖼️  썸네일: https://nng-phinf.pstatic.net/...
👥 시청자 수: 0명
⏰ 시작 시간: 2024. 1. 20. 오후 3:15:42

📄 전체 JSON 응답 데이터:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{
  "code": 200,
  "message": null,
  "content": {
    "channelId": "789d1d9c5b58c847f9f18c8e5073c580",
    "channelName": "아우슈",
    "channelImageUrl": "https://nng-phinf.pstatic.net/...",
    "verifiedMark": false,
    "channelType": "STREAMING",
    "channelDescription": "",
    "followerCount": 2,
    "openLive": true,
    "subscriptionAvailability": false,
    // ... 전체 응답 데이터 ...
  }
}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 🔧 고급 사용법

### 채널 정보 상세 조회
```bash
# 특정 채널 정보 전체 확인
npm run channel-info [채널ID]

# 여러 채널 동시 테스트
node test/chzzk-channel-info.js --all

# 직접 실행
node test/chzzk-channel-info.js [채널ID]
```

### 디버깅 모드
```bash
# 상세 로그 확인
DEBUG=* node test/chzzk-chat-terminal.js [채널ID]
```

### 특정 서버 테스트
터미널 스크립트는 자동으로 서버를 전환하지만, 특정 서버만 테스트하려면 코드를 수정할 수 있습니다.

## ⚠️ 주의사항

1. **라이브 방송 중인 채널만 가능**
   - 방송이 종료된 채널은 채팅 연결 불가

2. **네트워크 연결 필요**
   - 안정적인 인터넷 연결 필요
   - 방화벽에서 웹소켓 연결 허용

3. **Node.js 버전**
   - Node.js 14.0.0 이상 필요
   - WebSocket 라이브러리 의존성

## 🐛 문제 해결

### 연결 실패 시
```bash
# 채널 ID 확인
echo "채널 ID 길이: $(echo '9ae7d38b629b78f48e49fb3106218ff5' | wc -c)"

# 방송 상태 확인
curl -H "User-Agent: Mozilla/5.0" \
  "https://api.chzzk.naver.com/polling/v1/channels/9ae7d38b629b78f48e49fb3106218ff5/live-status"
```

### 권한 오류 시
```bash
# 의존성 재설치
rm -rf node_modules package-lock.json
npm install
```

## 📝 개발 정보

### 사용된 API
- **채널 정보**: `https://api.chzzk.naver.com/polling/v1/channels/{channelId}/live-status`
- **채팅 채널 ID**: `https://api.chzzk.naver.com/service/v1/channels/{channelId}/live-detail`
- **액세스 토큰**: `https://comm-api.game.naver.com/nng_main/v1/chats/access-token`

### 웹소켓 프로토콜
- **연결**: `{"ver":"2","cmd":100,"svcid":"game","cid":"...","bdy":{...}}`
- **핑퐁**: `{"ver":"2","cmd":0}` → `{"ver":"2","cmd":10000}`
- **채팅 메시지**: `{"cmd":93101,"bdy":[...]}`

### 기술 스택
- Node.js + WebSocket (ws)
- HTTPS 요청
- JSON 메시지 프로토콜
- 자동 재연결 로직

## 🎯 활용 방안

1. **채팅 봇 개발** - 실시간 채팅 데이터 수집
2. **방송 모니터링** - 채널 활동 상태 확인
3. **채널 정보 분석** - 팔로워 수, 시청자 수, 방송 패턴 분석
4. **데이터 수집** - 채널 통계, 방송 일정, 구독자 정보 수집
5. **알림 시스템** - 특정 키워드 감지, 방송 시작 알림
6. **API 연구** - 치지직 API 구조 분석 및 새로운 기능 발견

---

💡 **팁**: 여러 터미널 창을 열어서 동시에 여러 채널을 모니터링할 수 있습니다! 